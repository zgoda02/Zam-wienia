<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>System Zam√≥wie≈Ñ ‚Äî Pe≈Çna wersja</title>
  <meta name="robots" content="noindex">
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='.9em' font-size='90'%3Eüßæ%3C/text%3E%3C/svg%3E">
  <style>
    /* ============ Reset & base ============ */
    *,*::before,*::after { box-sizing: border-box; }
    html,body { height:100%; }
    body {
      margin: 0;
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      color: #fff;
      background: linear-gradient(135deg,#0b1220 0%, #5b1b84 50%, #0b1220 100%);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }
    a { color: inherit; text-decoration: none; }

    /* ============ Layout ============ */
    .container { max-width: 1200px; margin: 0 auto; padding: 22px; }
    .row { display:flex; gap: 12px; align-items:center; flex-wrap:wrap; }
    .center { display:flex; align-items:center; justify-content:center; }
    .hidden { display:none !important; }

    /* ============ Glass card ============ */
    .card {
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.12);
      border-radius: 14px;
      padding: 18px;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      box-shadow: 0 10px 30px rgba(0,0,0,0.45);
    }
    .card-title { font-weight:800; font-size:1.1rem; color:#c4b5fd; margin:0 0 8px 0; }

    /* ============ Header / Buttons ============ */
    .app-header { display:flex; align-items:center; justify-content:space-between; gap:12px; flex-wrap:wrap; }
    .brand { display:flex; align-items:center; gap:12px; }
    .brand-logo {
      width:48px; height:48px; border-radius:12px; display:flex; align-items:center; justify-content:center;
      background: rgba(168,85,247,0.2); border:1px solid rgba(196,181,253,0.25); font-size:22px;
    }

    .badge {
      background: rgba(249,115,22,0.18);
      border:1px solid rgba(250,204,21,0.18);
      color:#fde68a; padding:6px 10px; border-radius:999px; font-weight:700; font-size:13px;
    }

    .btn {
      border: none; border-radius:10px; padding:9px 12px; font-weight:700; cursor:pointer;
      display:inline-flex; align-items:center; gap:8px;
    }
    .btn:disabled { opacity:.6; cursor:not-allowed; }

    .btn-ghost { background: rgba(255,255,255,0.06); color:#e5e7eb; border:1px solid rgba(255,255,255,0.08); }
    .btn-primary { background: rgba(59,130,246,0.2); color:#c4b5fd; border:1px solid rgba(147,197,253,0.18); }
    .btn-success { background: rgba(34,197,94,0.18); color:#bbf7d0; border:1px solid rgba(74,222,128,0.15); }
    .btn-danger { background: rgba(239,68,68,0.18); color:#fecaca; border:1px solid rgba(248,113,113,0.15); }
    .btn-warning { background: rgba(234,179,8,0.18); color:#fde68a; border:1px solid rgba(250,204,21,0.12); }

    /* ============ Select (wyra≈∫niejszy) ============ */
    .select {
      appearance: none;
      -webkit-appearance: none;
      padding: 10px 14px;
      font-weight: 800;
      border-radius: 10px;
      border: 2px solid rgba(255,255,255,0.15);
      background: rgba(255,255,255,0.95);
      color: #0b1220;
      font-size: 14px;
      outline: none;
      box-shadow: 0 4px 10px rgba(11,18,32,0.25);
    }
    .select:focus { border-color: rgba(168,85,247,0.5); box-shadow: 0 6px 18px rgba(24,24,48,0.35); }

    /* ============ Grid and items ============ */
    .grid { display:grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap:14px; }
    .item { position:relative; overflow:visible; }
    .item .item-body { padding:12px; }
    .item .item-name { font-weight:800; font-size:1rem; color:#fff; }
    .item .price-row { display:flex; justify-content:space-between; align-items:center; margin-top:8px; gap:10px; }
    .tier { font-size:12px; padding:6px 8px; border-radius:8px; background: rgba(59,130,246,0.15); color:#bfdbfe; border:1px solid rgba(147,197,253,0.12); font-weight:700; }
    .value { font-weight:900; padding:6px 10px; border-radius:8px; background: rgba(34,197,94,0.12); color:#86efac; border:1px solid rgba(74,222,128,0.12); }

    .qty { display:flex; align-items:center; gap:8px; margin-top:10px; }
    .pill { min-width:36px; text-align:center; font-weight:900; background: rgba(255,255,255,0.06); padding:6px 8px; border-radius:8px; border:1px solid rgba(255,255,255,0.06); }

    /* corner delete (‚úñ) ‚Äî visible only for admin (via body.admin) */
    .corner-delete {
      position:absolute; top:10px; right:10px;
      width:28px; height:28px; border-radius:999px; border:none; font-weight:900; cursor:pointer;
      background: rgba(239,68,68,0.85); color:#fff; display:none; align-items:center; justify-content:center;
      box-shadow: 0 6px 18px rgba(0,0,0,0.45);
    }
    body.admin .corner-delete { display:flex; }

    /* admin-only small ghost button (used in some places) */
    .admin-only { display:none; }
    body.admin .admin-only { display: inline-flex; }

    /* modal styles */
    .modal-backdrop { position:fixed; inset:0; display:none; align-items:center; justify-content:center; background: rgba(0,0,0,0.6); z-index:60; padding:16px; }
    .modal { max-width:520px; width:100%; }
    .field { display:flex; flex-direction:column; gap:6px; margin-top:10px; }
    .input { padding:10px 12px; border-radius:10px; border:1px solid rgba(255,255,255,0.12); background: rgba(255,255,255,0.06); color:#fff; }

    /* export preview */
    table { width:100%; border-collapse:collapse; }
    th,td { padding:8px 10px; border-bottom:1px solid rgba(255,255,255,0.06); }
    th { color:#c4b5fd; text-align:left; font-weight:800; }

    @media (max-width:520px){
      .brand-logo{ width:40px; height:40px; font-size:18px }
      .select{ font-size:13px; padding:8px 10px; }
    }
  </style>
</head>
<body>
  <!-- LOGIN -->
  <section id="loginScreen" class="center" style="height:100vh;padding:24px">
    <div class="card" style="max-width:440px;text-align:center">
      <div style="font-size:22px;font-weight:900;margin-bottom:6px">üîê System Zam√≥wie≈Ñ</div>
      <div class="kicker" style="opacity:.85">Zaloguj siƒô jako Go≈õƒá lub Administrator</div>
      <div style="margin-top:16px;display:flex;flex-direction:column;gap:10px">
        <button class="btn btn-success" onclick="login('guest')">üë§ Zaloguj jako Go≈õƒá</button>
        <button class="btn btn-primary" onclick="openAdminLogin()">‚öôÔ∏è Panel Administratora</button>
      </div>
    </div>
  </section>

  <!-- MAIN APP -->
  <main id="mainApp" class="hidden">
    <div class="container">
      <!-- header -->
      <div class="card app-header">
        <div class="brand">
          <div class="brand-logo">üßÆ</div>
          <div>
            <div style="font-weight:900">System Zam√≥wie≈Ñ</div>
            <div class="kicker" style="opacity:.9">Wersja demo (frontend). Dane zapisujemy w przeglƒÖdarce lub przez API.</div>
          </div>
        </div>
        <div class="row">
          <span id="userBadge" class="badge">Go≈õƒá</span>
          <button class="btn btn-ghost" onclick="logout()">üö™ Wyloguj</button>
        </div>
      </div>

      <!-- controls -->
      <div class="card">
        <div class="row" style="align-items:center;justify-content:space-between">
          <div class="row" style="align-items:center;gap:12px">
            <label for="tierSelect" style="font-weight:700;color:#cbd5e1">Rodzaj u≈ºytkownika</label>
            <select id="tierSelect" class="select" onchange="setTier(this.value)">
              <option value="H">Cz≈Çonek (H)</option>
              <option value="S">Supporter (S)</option>
            </select>
          </div>

          <div class="row admin-only" style="align-items:center;gap:8px;">
            <button id="editBtn" class="btn btn-warning" onclick="toggleEditMode()">‚úèÔ∏è Tryb edycji: WY≈Å</button>
            <button class="btn btn-success" onclick="openAddModal()">‚ûï Dodaj przedmiot</button>
            <button class="btn btn-primary" onclick="exportData()">üì¶ Eksport</button>
            <label class="btn btn-ghost" for="importFile">üì• Import JSON</label>
            <input id="importFile" class="hidden" type="file" accept="application/json" onchange="importData(event)">
          </div>
        </div>
      </div>

      <!-- categories -->
      <section class="row" style="gap:16px">
        <div class="card" style="flex:1 1 360px;min-width:300px;">
          <h3 class="card-title">üî´ Klamoty</h3>
          <div id="cat-klamoty" class="grid"></div>
        </div>

        <div class="card" style="flex:1 1 360px;min-width:300px;">
          <h3 class="card-title">üõ°Ô∏è Dodatki</h3>
          <div id="cat-dodatki" class="grid"></div>
        </div>

        <div class="card" style="flex:1 1 360px;min-width:300px;">
          <h3 class="card-title">üîπ Ammo</h3>
          <div id="cat-ammo" class="grid"></div>
        </div>
      </section>

      <!-- summary -->
      <div class="card summary" style="margin-top:16px;display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap">
        <div class="totals">Przedmioty: <span id="totalCount">0</span>&nbsp;|&nbsp;Suma: <span id="totalPrice">0$</span></div>
        <div class="row">
          <button class="btn btn-danger" onclick="resetCart()">üßπ Wyzeruj koszyk</button>
          <button class="btn btn-success" onclick="placeOrder()">‚úÖ Z≈Ç√≥≈º zam√≥wienie (demo)</button>
        </div>
      </div>

      <!-- export preview -->
      <div id="exportPreview" class="card hidden" style="margin-top:16px;">
        <h3 class="card-title">PodglƒÖd danych</h3>
        <div id="exportTableWrap"></div>
      </div>
    </div>
  </main>

  <!-- ADD ITEM MODAL -->
  <div id="modalBackdrop" class="modal-backdrop">
    <div class="card modal">
      <div class="card-title">‚ûï Dodaj nowy przedmiot</div>
      <div class="row-split" style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
        <div class="field">
          <label class="label">Kategoria</label>
          <select id="newCategory" class="input">
            <option value="klamoty">Klamoty</option>
            <option value="dodatki">Dodatki</option>
            <option value="ammo">Ammo</option>
          </select>
        </div>
        <div class="field">
          <label class="label">Id (unikalne, bez spacji)</label>
          <input id="newId" class="input" placeholder="np. vintek">
        </div>
      </div>

      <div class="field">
        <label class="label">Nazwa</label>
        <input id="newName" class="input" placeholder="np. Vintek">
      </div>

      <div class="row-split" style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
        <div class="field">
          <label class="label">Cena Cz≈Çonek (H)</label>
          <input id="newPriceH" type="number" class="input" placeholder="np. 300000">
        </div>
        <div class="field">
          <label class="label">Cena Supporter (S)</label>
          <input id="newPriceS" type="number" class="input" placeholder="np. 270000">
        </div>
      </div>

      <div class="field">
        <label class="label">Jednostka (opcjonalnie)</label>
        <input id="newUnit" class="input" placeholder="np. szt.">
      </div>

      <div style="display:flex;justify-content:flex-end;gap:10px;margin-top:14px">
        <button class="btn btn-ghost" onclick="closeAddModal()">Anuluj</button>
        <button class="btn btn-success" onclick="saveNewItem()">Zapisz</button>
      </div>
    </div>
  </div>

  <!-- ADMIN LOGIN MODAL (basic demo) -->
  <div id="adminLoginModal" class="modal-backdrop">
    <div class="card modal">
      <div class="card-title">üîë Logowanie Administratora</div>
      <div class="field">
        <label class="label">Login</label>
        <input id="adminLogin" class="input" placeholder="admin">
      </div>
      <div class="field">
        <label class="label">Has≈Ço</label>
        <input id="adminPass" type="password" class="input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
      </div>
      <div style="display:flex;justify-content:flex-end;gap:10px;margin-top:12px">
        <button class="btn btn-ghost" onclick="closeAdminLogin()">Anuluj</button>
        <button class="btn btn-primary" onclick="submitAdminLogin()">Zaloguj</button>
      </div>
      <div style="margin-top:10px;font-size:13px;color:#cbd5e1">Demo: dowolny login, has≈Ço <b>admin123</b>.</div>
    </div>
  </div>

  <script>
    /* ===================== STATE ===================== */
    const $ = (s) => document.querySelector(s);
    const $$ = (s) => Array.from(document.querySelectorAll(s));
    let currentUser = null; // 'guest' | 'admin'
    let currentTier = 'H';  // H | S
    let editMode = false;
    let cart = {};
    let items = {};

    const DEFAULT_DATA = {
      klamoty: {
        vintek: { name: 'Vintek', prices: { H: 300000, S: 270000 }, unit: '' },
        pistol: { name: 'Pistolet', prices: { H: 75000, S: 50000 }, unit: '' },
        taser: { name: 'Taser', prices: { H: 120000, S: 100000 }, unit: '' }
      },
      dodatki: {
        kajdanki: { name: 'Kajdanki', prices: { H: 150000, S: 125000 }, unit: '' },
        kamizelka: { name: 'Kamizelka', prices: { H: 250000, S: 200000 }, unit: '' },
        latarka: { name: 'Latarka', prices: { H: 15000, S: 10000 }, unit: '' }
      },
      ammo: {
        ammo9: { name: 'Ammo 9mm', prices: { H: 1500, S: 1250 }, unit: 'szt.' },
        ammo556: { name: 'Ammo 5.56', prices: { H: 2500, S: 2200 }, unit: 'szt.' }
      }
    };

    /* ===================== UTIL ===================== */
    function formatPrice(p){
      if (p >= 1000000) return (p/1000000).toFixed(1) + 'M$';
      if (p >= 1000) return Math.round(p/1000) + 'k$';
      return p + '$';
    }
    function escapeHtml(s){ return (s||'').toString().replace(/[&<>"']/g, (m)=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;'}[m])); }

    /* ===================== APP LIFECYCLE ===================== */
    function login(type){
      currentUser = type;
      $('#loginScreen').classList.add('hidden');
      $('#mainApp').classList.remove('hidden');
      $('#userBadge').textContent = type === 'admin' ? 'Administrator' : 'Go≈õƒá';
      document.body.classList.toggle('admin', type === 'admin');
      // show/hide admin-only controls
      $$('.admin-only').forEach(el => el.style.display = (type === 'admin') ? '' : 'none');
      // load items
      loadState();
      renderAll();
    }

    function logout(){
      // simple logout: reset view and reload to clear transient state
      currentUser = null;
      document.body.classList.remove('admin');
      location.reload();
    }

    function openAdminLogin(){
      $('#adminLoginModal').style.display = 'flex';
      $('#adminLogin').focus();
    }
    function closeAdminLogin(){ $('#adminLoginModal').style.display = 'none'; }

    function submitAdminLogin(){
      const pass = $('#adminPass').value;
      // Demo: admin password = admin123 (visible in code)
      if(pass === 'admin123'){
        closeAdminLogin();
        login('admin');
      } else {
        alert('Nieprawid≈Çowe has≈Ço (demo: admin123).');
      }
    }

    function setTier(v){
      currentTier = v;
      saveState();
      renderAll();
    }

    /* ===================== Storage ===================== */
    function loadState(){
      const saved = localStorage.getItem('itemsData');
      items = saved ? JSON.parse(saved) : JSON.parse(JSON.stringify(DEFAULT_DATA));
      const savedTier = localStorage.getItem('tier');
      if(savedTier){ currentTier = savedTier; $('#tierSelect').value = currentTier; }
      initCart();
    }
    function saveState(){
      localStorage.setItem('itemsData', JSON.stringify(items));
      localStorage.setItem('tier', currentTier);
    }

    function initCart(){
      cart = {};
      Object.keys(items).forEach(cat => {
        Object.keys(items[cat]).forEach(id => { cart[id] = 0; });
      });
      updateTotals();
    }

    /* ===================== RENDER ===================== */
    function renderAll(){
      renderCategory('klamoty', '#cat-klamoty');
      renderCategory('dodatki', '#cat-dodatki');
      renderCategory('ammo', '#cat-ammo');
      updateTotals();
    }

    function renderCategory(catKey, mountSel){
      const mount = $(mountSel);
      mount.innerHTML = '';
      const data = items[catKey] || {};
      Object.keys(data).forEach(id => {
        const it = data[id];
        const outer = document.createElement('div');
        outer.className = 'item card';
        // build inner HTML: corner delete, name (editable in editMode), price, qty row
        outer.innerHTML = `
          <button class="corner-delete" title="Usu≈Ñ" onclick="deleteItem('${catKey}','${id}')">‚úñ</button>
          <div class="item-body">
            <div class="item-name" ${editMode ? 'contenteditable="true" data-field="name" data-id="'+id+'" data-cat="'+catKey+'"' : ''}>${escapeHtml(it.name)}</div>
            <div class="price-row">
              <div class="tier">Cennik: ${currentTier === 'H' ? 'Cz≈Çonek (H)' : 'Supporter (S)'} ${it.unit ? ' ¬∑ '+escapeHtml(it.unit) : ''}</div>
              <div class="value" ${editMode ? 'contenteditable="true" data-field="price" data-id="'+id+'" data-cat="'+catKey+'"' : ''}>${formatPrice(it.prices[currentTier])}</div>
            </div>
            <div class="qty">
              <button class="btn btn-danger" onclick="changeQty('${id}', -1)">‚àí</button>
              <div class="pill" id="qty-${id}">${cart[id]||0}</div>
              <button class="btn btn-success" onclick="changeQty('${id}', 1)">+</button>
              <div style="flex:1"></div>
              <button class="btn btn-ghost admin-only ${editMode ? '' : 'hidden'}" onclick="deleteItem('${catKey}','${id}')">üóëÔ∏è Usu≈Ñ</button>
            </div>
          </div>
        `;
        mount.appendChild(outer);
      });

      // attach edit handlers if in editMode
      if(editMode){
        mount.querySelectorAll('[contenteditable="true"]').forEach(el => {
          el.addEventListener('blur', handleEditBlur);
          el.addEventListener('keydown', e => { if(e.key === 'Enter'){ e.preventDefault(); el.blur(); } });
        });
      }
    }

    function handleEditBlur(e){
      const el = e.target;
      const id = el.getAttribute('data-id');
      const cat = el.getAttribute('data-cat');
      const field = el.getAttribute('data-field');
      if(!id || !cat) return;
      if(field === 'name'){
        const newName = el.textContent.trim();
        if(newName) items[cat][id].name = newName;
        else el.textContent = items[cat][id].name;
      } else if(field === 'price'){
        // parse price
        const parsed = parsePrice(el.textContent);
        if(!isNaN(parsed) && parsed >= 0){
          items[cat][id].prices[currentTier] = parsed;
          el.textContent = formatPrice(parsed);
        } else {
          el.textContent = formatPrice(items[cat][id].prices[currentTier]);
        }
      }
      saveState();
      updateTotals();
    }

    /* ===================== CART ===================== */
    function changeQty(id, delta){
      cart[id] = Math.max(0, (cart[id]||0) + delta);
      const el = $('#qty-'+id);
      if(el) el.textContent = cart[id];
      updateTotals();
    }

    function updateTotals(){
      let count = 0, sum = 0;
      Object.keys(items).forEach(cat => {
        Object.keys(items[cat]).forEach(id => {
          const q = cart[id] || 0;
          count += q;
          sum += q * (items[cat][id].prices[currentTier] || 0);
        });
      });
      $('#totalCount').textContent = count;
      $('#totalPrice').textContent = formatPrice(sum);
    }

    function resetCart(){
      Object.keys(cart).forEach(k => cart[k] = 0);
      $$('[id^="qty-"]').forEach(p => p.textContent = '0');
      updateTotals();
    }

    function placeOrder(){
      const lines = [];
      Object.keys(items).forEach(cat => {
        Object.keys(items[cat]).forEach(id => {
          const q = cart[id] || 0;
          if(q > 0){
            lines.push({ id, name: items[cat][id].name, qty: q, unit: items[cat][id].unit, price: items[cat][id].prices[currentTier] });
          }
        });
      });
      if(lines.length === 0){ alert('Koszyk jest pusty.'); return; }
      const total = lines.reduce((a,b)=> a + b.qty * b.price, 0);
      alert('Zam√≥wienie (demo) z≈Ço≈ºone! Pozycji: ' + lines.length + ' | Suma: ' + formatPrice(total));
      resetCart();
    }

    /* ===================== ADMIN: edit/add/delete ===================== */
    function toggleEditMode(){
      if(currentUser !== 'admin') return;
      editMode = !editMode;
      $('#editBtn').textContent = '‚úèÔ∏è Tryb edycji: ' + (editMode ? 'W≈Å' : 'WY≈Å');
      renderAll();
    }

    function openAddModal(){
      if(currentUser !== 'admin') return;
      $('#modalBackdrop').style.display = 'flex';
      $('#newCategory').value = 'klamoty';
      $('#newId').value = '';
      $('#newName').value = '';
      $('#newPriceH').value = '';
      $('#newPriceS').value = '';
      $('#newUnit').value = '';
      setTimeout(()=> $('#newId').focus(), 80);
    }
    function closeAddModal(){ $('#modalBackdrop').style.display = 'none'; }

    function saveNewItem(){
      const cat = $('#newCategory').value;
      const id = ($('#newId').value || '').trim();
      const name = ($('#newName').value || '').trim();
      const pH = parseInt($('#newPriceH').value, 10);
      const pS = parseInt($('#newPriceS').value, 10);
      const unit = ($('#newUnit').value || '').trim();
      if(!id || !name || isNaN(pH) || isNaN(pS)){ alert('Uzupe≈Çnij ID, nazwƒô i obie ceny.'); return; }
      if(!items[cat]) items[cat] = {};
      if(items[cat][id]){ alert('ID ju≈º istnieje.'); return; }
      items[cat][id] = { name, unit, prices: { H: pH, S: pS } };
      cart[id] = 0;
      saveState();
      closeAddModal();
      renderAll();
    }

    function deleteItem(cat, id){
      if(currentUser !== 'admin') return;
      if(!confirm('Na pewno usunƒÖƒá ‚Äû' + items[cat][id].name + '‚Äù?')) return;
      delete items[cat][id];
      delete cart[id];
      saveState();
      renderAll();
    }

    /* ===================== EXPORT / IMPORT ===================== */
    function exportData(){
      const exportObj = { items, meta: { exportedAt: new Date().toISOString(), tier: currentTier } };
      const json = JSON.stringify(exportObj, null, 2);
      const blob = new Blob([json], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'items-export.json';
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
      previewExport();
    }

    function previewExport(){
      const wrap = $('#exportTableWrap');
      wrap.innerHTML = '';
      const tbl = document.createElement('table');
      const thead = document.createElement('thead');
      thead.innerHTML = '<tr><th>Kategoria</th><th>ID</th><th>Nazwa</th><th>Jednostka</th><th>Cena H</th><th>Cena S</th></tr>';
      tbl.appendChild(thead);
      const tbody = document.createElement('tbody');
      Object.keys(items).forEach(cat => {
        Object.keys(items[cat]).forEach(id => {
          const it = items[cat][id];
          const tr = document.createElement('tr');
          tr.innerHTML = `<td>${cat}</td><td>${id}</td><td>${escapeHtml(it.name)}</td><td>${escapeHtml(it.unit||'')}</td><td>${it.prices.H}</td><td>${it.prices.S}</td>`;
          tbody.appendChild(tr);
        });
      });
      tbl.appendChild(tbody);
      wrap.appendChild(tbl);
      $('#exportPreview').classList.remove('hidden');
    }

    function importData(evt){
      const file = evt.target.files[0];
      if(!file) return;
      const reader = new FileReader();
      reader.onload = (e) => {
        try {
          const data = JSON.parse(e.target.result);
          if(!data.items) throw new Error('Brak pola items.');
          items = data.items;
          saveState();
          initCart();
          renderAll();
          alert('Zaimportowano dane.');
        } catch(err){
          alert('B≈ÇƒÖd importu: ' + err.message);
        }
        evt.target.value = '';
      };
      reader.readAsText(file);
    }

    /* ===================== PARSING HELPERS ===================== */
    function parsePrice(str){
      const s = (str||'').toString().trim().toLowerCase().replace(/\$/g,'').replace(/\s/g,'');
      if(!s) return NaN;
      if(/m$/.test(s)) return Math.round(parseFloat(s) * 1000000);
      if(/k$/.test(s)) return Math.round(parseFloat(s) * 1000);
      return parseInt(s, 10);
    }

    /* ===================== INIT (auto load default) ===================== */
    // start with default items for demo
    (function boot(){
      items = JSON.parse(JSON.stringify(DEFAULT_DATA));
      initCart();
      // keep export/import previews hidden
      $('#modalBackdrop').style.display = 'none';
      $('#exportPreview') && $('#exportPreview').classList.add('hidden');
    })();

    // small utility for selecting elements by pattern (used earlier)
    // add a simple polyfill for attribute-starts-with selector since we use it
    document.addEventListener('click', (e) => {
      // global click handler reserved for future uses
    });
  </script>
</body>
</html>
